---
layout: post
title: Bringing PHP and IoT together
date: 2016-05-31 18:42:15.000000000 -03:00
type: post
published: true
status: publish
categories:
- IoT
- php
tags:
- arduino
- blink
- iot
- led
- nano
- php
- protoboard
- serial
meta:
  _edit_last: '1'
  _login_radius_meta: '0'
  _yoast_wpseo_primary_category: '21'
  _yoast_wpseo_focuskw_text_input: iot
  _yoast_wpseo_focuskw: iot
  _yoast_wpseo_linkdex: '71'
  _oembed_eb91ceeda04c84e17cc7501997a02473: '{{unknown}}'
  _oembed_a8ad3f52c6d56743113dc2a82cb19b5b: '{{unknown}}'
  _oembed_07f46baa374d6972e27bb21ffd63285a: '{{unknown}}'
  _thumbnail_id: '857'
author:
  - Matheus Marabesi
---
<p>Recently I've been around IoT with PHP and I made some small projects suchs as LED blink, sensor management and so on. Therefore I chose PHP to be my main language to dig into IoT's world, for my surprise it was a tough decision.</p>
<p>Unfortunately we have few libraries written in PHP to deal with I/O and this kind of components, at first its normal the lack of content because PHP was built to be used in the web therefore we can make it better. Here I'm going to use PHP to connect with Arduino and turn on a LED.</p>
<p>So let's have a look in our sketch (the code goes into Arduino board)</p>
<pre class="lang:c decode:true " title="Arduino skecth">int led = 13;
String input = "";

void setup() {
  pinMode(led, OUTPUT);

  Serial.begin(9600);
}

void loop() {

  if (Serial.available() &gt; 0) { 
   
    input = Serial.readString();
    
    if (input == "ON") {
      digitalWrite(led, HIGH);
    } else {
      digitalWrite(led, LOW);
    }

    Serial.println(input);
  }
}</pre>
<p>I uploaded the same code on Autodesk 123D Circuits and you can try it yourself, just click on "Start Simulation".</p>
<h1>Simulation</h1>
<p>Probably if you are trying to simulate you will see nothing happening in the simulation and looks a bit strange, but it is exactly what it should do, nothing.</p>
<p>If we take a look inside the sketch we'll see a lot of interaction with Serial port and there is the reason why the Arduino does nothing. The Serial port is the way out of Arduino and the path to go to communicate with another devices or programming languages, we can see a few tutorials on Arduino <a href="http://playground.arduino.cc/" target="_blank">playground</a> to get a better idea.</p>
<p>Go ahead and after you click on "Start Simulation", click on "Code Editor" the console will show up with the core running on Arduino and in the right side there is a tab named "Serial Monitor", click on that as well. On the right panel will show up you can type any command to interact with, if you have any idea in what our sketch does, you see we must type "<strong>ON</strong>" to turn the LED on, and "<strong>OFF</strong>" to turn it off.</p>
<p><iframe width="100%" height="448" frameborder="0" marginheight="0" marginwidth="0" scrolling="no" src="https://123d.circuits.io/circuits/497523-devmedia-php-iot/embed#breadboard"></iframe></p>
<p>The PHP world will interact with Serial port on Arduino and send exactly the same command (ON, OFF) to turn the LED <strong>ON</strong> and <strong>OFF</strong>.</p>
<h1>Finally, the PHP</h1>
<p>Ok, now we understand how to run code in our simulator and we need to interact with PHP. To achieve that we are going to use PHP streams.</p>
<p>The functions used here are known to C developers and might be for PHP as well, let's see some code and after a explanation</p>
<pre class="lang:php decode:true" title="PHP code to interact with Arduino">$resource = fopen('/dev/ttyUSB0', '+r');

fwrite($resource, 'ON');</pre>
<p>The first thing we do is use the <strong>fopen</strong> function in a old known entry on linux, <strong>ttyUSB0</strong> under <strong>/dev</strong> directory means an USB device connected in one port in your computer/laptop, if you have more than one USB device connected the number 0 at the end will increase to USB1, USB2 and so on.</p>
<p>If no one USB were connected PHP will through an error like the following (so make sure your USB is connected both on Arduino and on your computer)</p>
<pre class="lang:vim decode:true " title="fopen error">PHP Warning:  fopen(/dev/ttyUSB0): failed to open stream: Inappropriate ioctl for device in /home/marabesi/fopen.php on line 3
</pre>
<p><img title="Arduino connected to the laptop" src="{{ site.baseurl }}/assets/connected-arduino-uno.jpg" alt="Image from Safari books - https://www.safaribooksonline.com/blog/2013/07/16/javascript-powered-arduino-with-johnny-five/" width="650" height="366" /></p>
<p>Then just be happy, if your Arduino is connected and you run the script in PHP the LED should turn on, to turn it off just change ON in the PHP script to OFF.</p>
<p>&nbsp;</p>
