---
layout: post
title: Getting started with Xpath
date: 2015-05-07 11:12:05.000000000 -03:00
image: /assets/2015-05-07-getting-started-xpath/cover.gif
type: post
published: true
status: publish
categories:
- php
tags:
- dom,
- nodes,
- php,
- simplexml,
- W3C,
- web,
- xpath,
- certification
author:
  - Matheus Marabesi
---
<p>Its been a long time since my last post and now I came up with a new subject interesting to me because I could find around me people that know and understand Xpath, so here I'm going to show what I've found about Xpath and the little particularities on it in PHP.</p>
<h1> A little bit of history</h1>
<p>The <a href="http://www.w3.org/TR/xpath" target="_blank">first version (1.0)</a> of Xpath was released in 1999 and the <a href="http://www.w3.org/TR/xpath20" target="_blank">second version (2.0) </a>came in 2011 and nowadays we have the <a href="http://www.w3.org/TR/xpath-30" target="_blank">Xpath 3.0</a> released in 2014.</p>
<p>Xpath was created to be able to easily navigate between nodes in a XML document and be able to find specific node as well by criteria using a query language.</p>
<h1>Xpath sintax</h1>
<p>The Xpath became famous for its light sintax and facilities of manipulating nodes on XML documents. Xpath sintax queries are alike URL's, for example you can use a common XPath such as "/rootNode/child/lastchild" to refer to lastchild directly, let's see the example bellow and make the things cleaner.</p>

{% highlight xml %}
<?xml version="1.0" encoding="utf-8"?>
<library>
  <book id="1">
    <author>Author 1</author>
    <summary>Summary 1</summary>
  </book>
  <book id="2">
    <author>Author 2</author>
    <summary>Summary 2</summary>
  </book>
  <book id="3">
    <author>Author 3</author>
    <summary>Summary 3</summary>
  </book>
</library>
{% endhighlight %}

<p>Following our thoughts to reach the tag <book> we can do "/library/book" so this way we are going to have three elements. We can also be more specific with our document, let's say that we want to have just the book with the id 1, this way we can use "/library/book[@id=1]"</p>
<p>*tip: Google for <strong>xpath tester</strong> and try out the examples in this post</p>
<table>
<tbody>
<tr>
<th>Expression</th>
<th>Description</th>
</tr>
<tr>
<td>/</td>
<td>Selects from the root node</td>
</tr>
<tr>
<td>//</td>
<td>Selects nodes in the document from the current node that<br />
match the selection no matter where they are</td>
</tr>
<tr>
<td>.</td>
<td>Selects the current node</td>
</tr>
<tr>
<td>..</td>
<td>Selects the parent of the current node</td>
</tr>
<tr>
<td>@</td>
<td>Selects attributes</td>
</tr>
</tbody>
</table>
<p><small>Example from w3schools : http://www.w3schools.com/xpath/xpath_syntax.asp</small></p>
<h1>Xpath and PHP</h1>
<p>Now we have the basics of Xpath we can play around with PHP and see how it interacts with Xpath. The first thing we must have in mind is that PHP have two alternatives to accomplish this task and one is using simplexml family functions or we have also the DOMXpath family.</p>

{% highlight PHP %}
<?php
$xml = simplexml_load_file('library.xml');

$xml->xpath('/library/book[@id=1]');
{% endhighlight %}
    
<p>Using simplexml the function will return to us all matched elements inside an array with SimpleXMLElement on it.</p>

{% highlight php %}
Array
(
    [0] => SimpleXMLElement Object
        (
            [@attributes] => Array
                (
                    [id] => 1
                )

            [author] => Author 1
            [summary] => Summary 1
        )

)
{% endhighlight %}

<p>Otherwise we can use the DOMXpath to complete or task but we will need a few more lines but we have a OOP approach.</p>

{% highlight php %}
<?php
$dom = new DOMDocument();
$dom->load('library.xml');

$xpath = new DOMXpath($dom);
{% endhighlight %}

<p>Therefore the return change as well</p>

{% highlight php %}
DOMNodeList Object
(
    [length] => 1
)
{% endhighlight %}

<h1>Try it yourself</h1>
<p>We have many possibilities when we are using Xpath and also we can do a lot of things with it, the only way to get know is getting your hands dirty and try different queries in different files!</p>
